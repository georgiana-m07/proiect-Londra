YUI.add("search-subnav-slender-view",(function(e){var r=[{id:"photos",intlKey:"search.PHOTOS",searchType:e.SearchUrl.searchTypes.PHOTOS},{id:"people",intlKey:"search.PEOPLE",searchType:e.SearchUrl.searchTypes.PEOPLE},{id:"groups",intlKey:"search.GROUPS",searchType:e.SearchUrl.searchTypes.GROUPS}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(a){var t,s=this,h=a.modelParams&&a.modelParams.apiParams?e.merge(a.modelParams.apiParams):{},i=[];return this.set("searchType",a.searchType),this.set("searchUrl",new e.SearchUrl(h,this.appContext,this.get("searchType"))),this.set("showAdvancedClearLink",this.get("searchType")===e.SearchUrl.searchTypes.PHOTOS&&this.get("searchUrl").hasAdvancedParams(!1)),r.forEach((function(r){(t=e.merge(r,{title:s.intlMessage({intlName:r.intlKey}),url:s.buildTabUrl(r.id,r.searchType),selected:r.searchType===s.get("searchType")})).selected&&(s.set("currentTabUrl",t.url),s.set("currentTabId",t.id)),i.push(t)})),this.set("links",i),this},buildContainer:function(){return this.setContainerWithTemplate("search-subnav",{showInactiveToggle:!1,showTools:!1,selectedSort:!1,showSort:!1,showAdvanced:!1,links:this.get("links"),showAdvancedClearLink:this.get("showAdvancedClearLink")}),this},activate:function(){return e.SearchUrl.isSearchUrl(this.appContext.getPreviousURL())||this.clearStoredTabUrls(),this.get("currentTabUrl")&&this.get("currentTabId")&&this.storeTabUrl(this.get("currentTabUrl"),this.get("currentTabId")),this.get("showAdvancedClearLink")&&this.registerEventHandler(this.get("container").one(".advanced-clear-link").on("click",this.handleClearAdvancedSearchClick.bind(this))),this},buildTabUrl:function(r,a){var t,s=a!==this.get("searchType")?this.checkForStoredUrl(r):null,h=this.get("searchUrl").getSearchTerm();return s?h!==(t=new e.SearchUrl(s,this.appContext,a)).getSearchTerm()&&t.removeScope().resetToUnified().setSearchTerm(h):(t=this.get("searchUrl").clone().setSearchType(a),a!==this.get("searchType")&&(t.removeAPIParam(e.SearchHelper.API.sort),t.removeAPIParam(e.SearchHelper.API.safeSearch)),a!==e.SearchUrl.searchTypes.PHOTOS&&t.removeScope()),t.getURL()},checkForStoredUrl:function(r){var a,t;return YUI.Env.isServer||(t=this.getStorageKeyFromTabId(r),a=e.StorageHelper.getItem(t,!0)),a},clearStoredTabUrls:function(){var r,a=this;YUI.Env.isServer||this.get("links").forEach((function(t){r=a.getStorageKeyFromTabId(t.id),e.StorageHelper.remove(r,!0)}))},storeTabUrl:function(r,a){var t;YUI.Env.isServer||(t=this.getStorageKeyFromTabId(a),e.StorageHelper.setItem(t,r,!0))},getStorageKeyFromTabId:function(e){return"searchUrl-"+e},handleClearAdvancedSearchClick:function(r){var a,t=this.get("searchUrl").getSearchTerm(),s=this.get("searchUrl").getAPIParams();r.halt(),e.SearchHelper.clearParamsExceptSearchScope(s),delete s[e.SearchHelper.API.commons],a=new e.SearchUrl(s,this.appContext,this.searchType),t&&a.setSearchTerm(t),this.appContext.flapp.navigate(a.getURL())}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-subnav","storage-helper","search-helper","search-url"],langBundles:["search"]});YUI.add("hermes-template-search-empty",(function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,l,a){return"safe-search"},3:function(e,t,n,l,a){var s,r=e.escapeExpression,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t<div class="no-results-message">\n\t\t\t\t<h5>'+r(e.lambda(null!=(s=null!=t?o(t,"noMatchesForQuery"):t)?o(s,"noMatchesText"):s,t))+"</h5>\n\t\t\t\t<h5>"+r((o(n,"intlMessage")||t&&o(t,"intlMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlMessage",hash:{intlName:"search.TRY_DIFFERENT_BROADER"},data:a,loc:{start:{line:6,column:8},end:{line:6,column:63}}}))+"</h5>\n\t\t\t</div>\n"},5:function(e,t,n,l,a){var s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,o=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t<div class="no-results-message">\n\t\t\t\t<h5>'+o((i(n,"intlMessage")||t&&i(t,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"search.API_ERROR_HEADER"},data:a,loc:{start:{line:11,column:8},end:{line:11,column:58}}}))+"</h5>\n\t\t\t\t<h5>"+o((i(n,"intlMessage")||t&&i(t,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"search.API_ERROR_SUBHEADER"},data:a,loc:{start:{line:12,column:8},end:{line:12,column:61}}}))+"</h5>\n\t\t\t</div>\n"},7:function(e,t,n,l,a){var s,r=e.lambda,o=e.escapeExpression,i=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t<div class="no-results-message safe-search">\n\t\t\t\t<h5>'+o(r(null!=(s=null!=t?c(t,"safeSearchLimitedResults"):t)?c(s,"safeSearchLimitedResultsText"):s,t))+'</h5>\n\t\t\t\t<button class="flex hollow black disable-safe-search '+(null!=(s=c(n,"if").call(i,null!=(s=null!=t?c(t,"safeSearchLimitedResults"):t)?c(s,"showSafeSearchDropdown"):s,{name:"if",hash:{},fn:e.program(8,a,0),inverse:e.noop,data:a,loc:{start:{line:18,column:57},end:{line:18,column:129}}}))?s:"")+'">\n\t\t\t\t\t'+o(r(null!=(s=null!=t?c(t,"safeSearchLimitedResults"):t)?c(s,"safeSearchLimitedResultsButtonText"):s,t))+"\n"+(null!=(s=c(n,"if").call(i,null!=(s=null!=t?c(t,"safeSearchLimitedResults"):t)?c(s,"showSafeSearchDropdown"):s,{name:"if",hash:{},fn:e.program(10,a,0),inverse:e.noop,data:a,loc:{start:{line:20,column:5},end:{line:24,column:12}}}))?s:"")+"\t\t\t\t</button>\n\t\t\t</div>\n"},8:function(e,t,n,l,a){return"with-arrow"},10:function(e,t,n,l,a){return'\t\t\t\t\t\t<span class="arrow">\n\t\t\t\t\t\t\t<svg class="icon icon-dropdown_arrow"><use xlink:href="#icon-dropdown_arrow"></use></svg>\n\t\t\t\t\t\t</span>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var s,r=null!=t?t:e.nullContext||{},o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="search-empty '+(null!=(s=o(n,"if").call(r,null!=t?o(t,"safeSearchLimitedResults"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:25},end:{line:1,column:75}}}))?s:"")+'">\n\t<div class="no-results-message-container">\n'+(null!=(s=o(n,"if").call(r,null!=t?o(t,"noMatchesForQuery"):t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:2},end:{line:8,column:9}}}))?s:"")+(null!=(s=o(n,"if").call(r,null!=t?o(t,"apiFailed"):t,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a,loc:{start:{line:9,column:2},end:{line:14,column:9}}}))?s:"")+(null!=(s=o(n,"if").call(r,null!=t?o(t,"safeSearchLimitedResults"):t,{name:"if",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a,loc:{start:{line:15,column:2},end:{line:27,column:9}}}))?s:"")+"\t</div>\n</div>\n\n"},useData:!0}),l={};e.Array.each([],(function(t){var n=e.Template.get("hermes/"+t);n&&(l[t]=n)})),e.Template.register("hermes/search-empty",(function(t,a){return(a=a||{}).partials=a.partials?e.merge(l,a.partials):l,n(t,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-empty-view",(function(e){"use strict";var t=[{intlKey:"search.SAFESEARCH_ON",value:"safe",prefValue:0,isDefault:!0},{intlKey:"search.SAFESEARCH_MODERATE",value:"moderate",prefValue:1},{intlKey:"search.SAFESEARCH_OFF",value:"restricted",prefValue:2}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(a){var s=a.modelParams&&a.modelParams.apiParams?e.merge(a.modelParams.apiParams):{};this.searchUrl=new e.SearchUrl(s,this.appContext,a.searchType||e.SearchUrl.searchTypes.UNDEFINED),this.searchType=a.searchType,this.isMobile=a.isMobile;var r,i=this.searchUrl.getAPIParam(e.SearchHelper.API.safeSearch);this.safeSearches=[],t.forEach((t=>{r=e.merge(t,{text:this.intlMessage({intlName:t.intlKey})}),i?r.value===i&&(r.isSelected=!0,this.set("selectedSafeSearch",r.value),this.set("selectedSafeSearchText",r.text),this.usedAPISafeSearch=!0):r.isDefault&&(r.isSelected=!0,this.set("selectedSafeSearch",r.value),this.set("selectedSafeSearchText",r.text)),this.safeSearches.push(r)})),""===this.get("container").get("innerHTML")&&this.setContainerHTML("")},loadState:function(){var t=[];return this.appContext.getViewer().signedIn&&t.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then((e=>{this.set("viewerPrefsModel",e),this.safeSearches.forEach((t=>{t.isDefault=!1,this.usedAPISafeSearch||(t.isSelected=!1),t.prefValue===e.getValue("safeSearch")&&(this.usedAPISafeSearch||(t.isSelected=!0,this.set("selectedSafeSearch",t.value),this.set("selectedSafeSearchText",t.text)),t.isDefault=!0)}))}))),e.Promise.all(t)},buildContainer:function(){var t="search.PHOTOS_PEOPLE_OR_GROUPS";return this.isMobile&&(this.searchType===e.SearchUrl.searchTypes.PHOTOS?t="search.SEARCH_PHOTOS":this.searchType===e.SearchUrl.searchTypes.PEOPLE?t="search.SEARCH_PEOPLE":this.searchType===e.SearchUrl.searchTypes.GROUPS&&(t="search.SEARCH_GROUPS")),t=this.intlMessage({intlName:t}),this.setContainerWithTemplate("search-empty",{searchPlaceholder:t,noMatchesForQuery:this.get("noMatchesForQuery"),apiFailed:this.get("apiFailed"),safeSearchLimitedResults:this.get("safeSearchLimitedResults")}),this},activate:function(){var e=this.get("container"),t=e.one("#search-field"),a=e.one(".disable-safe-search");return t&&setTimeout((function(){let e=t.getDOMNode(),a=e.value.length;e.setSelectionRange(a,a),t.focus()}),1e3),a&&this.registerEventHandler(a.on("click",(()=>{this.get("safeSearchLimitedResults").showSafeSearchDropdown?this.createSafeSearchDroparound():this.get("safeSearchLimitedResults").showAdultGroupsToggle&&this.showAdultGroups()}))),this},enableBlankState:function(e){this.get("container").addClass("blank")},onParentViewEvent:function(e,t){t&&"error-msg-updated"===t[0]&&(this.isBuilt&&this.buildContainer(),this.isActivated&&this.activate())},createSafeSearchDroparound:function(){var t=this.get("container").one(".disable-safe-search").one(".arrow");this.safeSearchMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnActionClick:!0,showDropArrow:!0,anchorElement:t,classList:"",overlayClassList:"",menuItems:this.safeSearches,preferBottom:!0,anchorOffsetVertical:-8}),this.safeSearchMenu.show(),this.registerEventHandler(this.safeSearchMenu.on("selected",(t=>{if(this.safeSearchMenu.close(),this.appContext.getViewer().signedIn||"moderate"!==t.menuItem.value&&"restricted"!==t.menuItem.value){switch(t.menuItem.value){case"safe":this.searchUrl.setAPIParam(e.SearchHelper.API.safeSearch,e.SearchHelper.PHOTOS_SAFE_SEARCH_SETTINGS.safe);break;case"moderate":this.searchUrl.setAPIParam(e.SearchHelper.API.safeSearch,e.SearchHelper.PHOTOS_SAFE_SEARCH_SETTINGS.moderate);break;case"restricted":this.searchUrl.setAPIParam(e.SearchHelper.API.safeSearch,e.SearchHelper.PHOTOS_SAFE_SEARCH_SETTINGS.restricted)}this.fire("subviewViewEvent","search:dirty"),this.appContext.flapp.navigate(this.searchUrl.getURL())}else this.showSignUpModal()})))},showAdultGroups:function(){this.appContext.getViewer().signedIn?(this.searchUrl.setAPIParam(e.SearchHelper.GROUPS_SEARCH_API.safeSearch,e.SearchHelper.GROUPS_SAFE_SEARCH_SETTINGS.all),this.appContext.flapp.navigate(this.searchUrl.getURL())):this.showSignUpModal()},showSignUpModal:function(){var t,a=e.config.win.location.href,s=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_TITLE"}),r=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_MESSAGE"});(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-search-mature",signUpTitle:s,signUpMessage:r,beaconPrefix:"searchFilter"})).on("signUpClick",(t=>{e.SigninHelper._redirectToSignUp("",{postLoginUrl:a})})),t.on("signInClick",(t=>{e.SigninHelper._redirectToSignin("",{postLoginUrl:a})})),t.show()}},{ATTRS:{noMatchesForQuery:{value:!1,validator:function(e,t){return!e||"object"==typeof e&&e.hasOwnProperty("noMatchesText")}},apiFailed:{value:!1,validator:function(t,a){return e.AttributeHelpers.validateBoolean(t)}},safeSearchLimitedResults:{value:!1,validator:function(e,t){return!e||"object"==typeof e&&e.hasOwnProperty("safeSearchLimitedResultsText")}}}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","search-url","attribute-helpers","hermes-template-search-empty"],langBundles:["search"]});YUI.add("hermes-template-search-photos-album-item",(function(e,l){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,l,a,t,n){var r,s,u=null!=l?l:e.nullContext||{},o=e.hooks.helperMissing,i="function",c=e.escapeExpression,m=e.lookupProperty||function(e,l){if(Object.prototype.hasOwnProperty.call(e,l))return e[l]};return'<a href="'+c(typeof(s=null!=(s=m(a,"url")||(null!=l?m(l,"url"):l))?s:o)===i?s.call(u,{name:"url",hash:{},data:n,loc:{start:{line:1,column:9},end:{line:1,column:16}}}):s)+'" class="search-photos-album-item"><div class="avatar album huge" style="background-image:url('+c(e.lambda(null!=(r=null!=(r=null!=l?m(l,"primaryPhotoSizes"):l)?m(r,"q"):r)?m(r,"src"):r,l))+')">\n\t<sup>'+c(typeof(s=null!=(s=m(a,"title")||(null!=l?m(l,"title"):l))?s:o)===i?s.call(u,{name:"title",hash:{},data:n,loc:{start:{line:2,column:6},end:{line:2,column:15}}}):s)+"</sup>\n\t<sub>"+c((m(a,"intlHTMLMessage")||l&&m(l,"intlHTMLMessage")||o).call(u,{name:"intlHTMLMessage",hash:{count:null!=l?m(l,"photoCount"):l,intlName:"search.GROUP_PHOTO_COUNT"},data:n,loc:{start:{line:3,column:6},end:{line:3,column:78}}}))+"</sub>\n</div></a>"},useData:!0}),t={};e.Array.each([],(function(l){var a=e.Template.get("hermes/"+l);a&&(t[l]=a)})),e.Template.register("hermes/search-photos-album-item",(function(l,n){return(n=n||{}).partials=n.partials?e.merge(t,n.partials):t,a(l,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-search-photos-albums",(function(l,n){var e=l.Template.Handlebars.revive({1:function(l,n,e,t,a){var r,o=null!=n?n:l.nullContext||{},s=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'\t<h5 class="search-results-header">'+(null!=(r=s(e,"unless").call(o,null!=n?s(n,"loading"):n,{name:"unless",hash:{},fn:l.program(2,a,0),inverse:l.noop,data:a,loc:{start:{line:2,column:35},end:{line:2,column:379}}}))?r:"")+l.escapeExpression((s(e,"intlMessage")||n&&s(n,"intlMessage")||l.hooks.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"search.YOUR_ALBUMS"},data:a,loc:{start:{line:2,column:379},end:{line:2,column:424}}}))+" "+(null!=(r=s(e,"if").call(o,null!=n?s(n,"loading"):n,{name:"if",hash:{},fn:l.program(8,a,0),inverse:l.noop,data:a,loc:{start:{line:2,column:425},end:{line:2,column:485}}}))?r:"")+"</h5>\n"+(null!=(r=s(e,"if").call(o,null!=n?s(n,"loading"):n,{name:"if",hash:{},fn:l.program(10,a,0),inverse:l.program(12,a,0),data:a,loc:{start:{line:3,column:1},end:{line:11,column:8}}}))?r:"")},2:function(l,n,e,t,a){var r,o=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(r=o(e,"if").call(null!=n?n:l.nullContext||{},null!=n?o(n,"viewingAll"):n,{name:"if",hash:{},fn:l.program(3,a,0),inverse:l.program(5,a,0),data:a,loc:{start:{line:2,column:54},end:{line:2,column:368}}}))?r:""},3:function(l,n,e,t,a){var r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'<span class="secondary">'+l.escapeExpression((r(e,"intlHTMLMessage")||n&&r(n,"intlHTMLMessage")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},{name:"intlHTMLMessage",hash:{count:null!=n?r(n,"total"):n,intlName:"search.RESULTS_COUNT"},data:a,loc:{start:{line:2,column:96},end:{line:2,column:159}}}))+"</span>"},5:function(l,n,e,t,a){var r,o=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(r=o(e,"unless").call(null!=n?n:l.nullContext||{},null!=n?o(n,"singleResult"):n,{name:"unless",hash:{},fn:l.program(6,a,0),inverse:l.noop,data:a,loc:{start:{line:2,column:174},end:{line:2,column:361}}}))?r:""},6:function(l,n,e,t,a){var r,o=null!=n?n:l.nullContext||{},s=l.hooks.helperMissing,i=l.escapeExpression,u=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'<a href="'+i("function"==typeof(r=null!=(r=u(e,"viewAllLink")||(null!=n?u(n,"viewAllLink"):n))?r:s)?r.call(o,{name:"viewAllLink",hash:{},data:a,loc:{start:{line:2,column:207},end:{line:2,column:222}}}):r)+'" class="view-more-link" data-track="search-viewall-albums">'+i((u(e,"intlHTMLMessage")||n&&u(n,"intlHTMLMessage")||s).call(o,{name:"intlHTMLMessage",hash:{count:null!=n?u(n,"total"):n,intlName:"search.VIEW_ALL_COUNT"},data:a,loc:{start:{line:2,column:282},end:{line:2,column:346}}}))+"</a>"},8:function(l,n,e,t,a){return'<div class="flickr-dots inline"></div>'},10:function(l,n,e,t,a){var r,o=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'\t\t<div style="height: '+l.escapeExpression("function"==typeof(r=null!=(r=o(e,"placeholderHeight")||(null!=n?o(n,"placeholderHeight"):n))?r:l.hooks.helperMissing)?r.call(null!=n?n:l.nullContext||{},{name:"placeholderHeight",hash:{},data:a,loc:{start:{line:4,column:22},end:{line:4,column:43}}}):r)+'px;"></div>\n'},12:function(l,n,e,t,a){var r,o,s=null!=n?n:l.nullContext||{},i=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'\t\t<div class="results'+(null!=(r=i(e,"unless").call(s,null!=n?i(n,"viewingAll"):n,{name:"unless",hash:{},fn:l.program(13,a,0),inverse:l.noop,data:a,loc:{start:{line:6,column:21},end:{line:6,column:62}}}))?r:"")+'" style="height: '+l.escapeExpression("function"==typeof(o=null!=(o=i(e,"resultsHeight")||(null!=n?i(n,"resultsHeight"):n))?o:l.hooks.helperMissing)?o.call(s,{name:"resultsHeight",hash:{},data:a,loc:{start:{line:6,column:79},end:{line:6,column:96}}}):o)+'px;">\n'+(null!=(r=i(e,"each").call(s,null!=n?i(n,"albums"):n,{name:"each",hash:{},fn:l.program(15,a,0),inverse:l.noop,data:a,loc:{start:{line:7,column:3},end:{line:9,column:12}}}))?r:"")+"\t\t</div>\n"},13:function(l,n,e,t,a){return" unified"},15:function(l,n,e,t,a){var r,o=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(r=l.invokePartial(o(t,"search-photos-album-item"),n,{name:"search-photos-album-item",data:a,indent:"\t\t\t\t",helpers:e,partials:t,decorators:l.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(l,n,e,t,a){var r,o=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(r=o(e,"unless").call(null!=n?n:l.nullContext||{},null!=n?o(n,"emptySearch"):n,{name:"unless",hash:{},fn:l.program(1,a,0),inverse:l.noop,data:a,loc:{start:{line:1,column:0},end:{line:12,column:11}}}))?r:""},usePartial:!0,useData:!0}),t={};l.Array.each(["search-photos-album-item"],(function(n){var e=l.Template.get("hermes/"+n);e&&(t[n]=e)})),l.Template.register("hermes/search-photos-albums",(function(n,a){return(a=a||{}).partials=a.partials?l.merge(t,a.partials):t,e(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-search-photos-album-item"]});YUI.add("search-photos-albums-view",(function(e,t){var i=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,emptySearch:!1,initializer:function(t){return""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("search-photos-albums",{loading:!0,placeholderHeight:120}),this.unifiedSubviewParams=t.unifiedSubviewParams||{},this.unifiedSubviewParams.albums&&this.unifiedSubviewParams.albums.fetchParams?(this.fetchParams=this.unifiedSubviewParams.albums.fetchParams,this.apiParams=e.merge(this.fetchParams.apiParams||{}),this.searchId=this.unifiedSubviewParams.albums.id):(this.apiParams={},this.fetchParams={}),this.searchUrl=new e.SearchUrl(this.apiParams,this.appContext,e.SearchUrl.searchTypes.PHOTOS),this.viewingAll=this.apiParams[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll],this.albumWidth=0,this.albumMarginWidth=0,this.albumResultsContainer=null,this.pageNum=0,this.initialAlbumModels=[],this},loadState:function(){var e,t=this;return this.appContext.getModel("search-sets-models",this.searchId||this.searchUrl.getId(),this.fetchParams).then((function(i){(e=i.getValue("sets"))&&e.toJSON().length<1&&(t.emptySearch=!0),t.searchModel=i,t.initialAlbumModels=t.searchModel.getValue("sets").getList()}))},buildContainer:function(){var t;return this.searchUrl.setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.albums,!0),this.searchUrl.setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll,!0),t={albums:this.searchModel.getValue("sets").toJSON(),total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),emptySearch:this.emptySearch,viewAllLink:this.searchUrl.getURL(),viewingAll:this.viewingAll,resultsHeight:this.viewingAll?void 0:130},this.setContainerWithTemplate("search-photos-albums",t),this},activate:function(){var t=this,i=this.get("container"),s=i.one(".album");if(this.albumResultsContainer=i.one(".results"),!this.viewingAll&&s&&(this.albumWidth=s.get("offsetWidth"),this.albumMarginWidth=14,this.albumWidth+=this.albumMarginWidth,this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.quantizeContainerWidth.bind(this))),this.quantizeContainerWidth(null)),this.viewingAll)return this.registerEventHandler(e.globalEvents.subscribe("window:scroll",e.betterThrottle(this.handleScroll.bind(this),100,this,!1))),this.loadMore().then((function(e){var i=(e=e.filter((function(e){return!t.initialAlbumModels.find((function(t){return t.id===e.id}))}))).map((function(e){return e.toJSON()}));return t.appendItems(i)}))},quantizeContainerWidth:function(e){var t,i=this.get("container").get("clientWidth");t=i-i%this.albumWidth+1,this.albumResultsContainer.setStyle("width",t+"px")},handleScroll:function(){var e=this;!this.isLoadingMore&&!this.isAtEnd&&this.albumResultsContainer.getDOMNode().getBoundingClientRect().bottom<this.appContext.viewportData.getHeight()+400&&this.loadMore().then((function(t){var i=t.map((function(e){return e.toJSON()}));e.appendItems(i)}))},loadMore:function(){var t,s=this;if(this.isLoadingMore||this.isAtEnd)return e.Promise.resolve([]);this.isLoadingMore=!0,this.pageNum++,t=Object.assign({},this.unifiedSubviewParams.albums.fetchParams,{page:this.pageNum,perPage:100});var a=e.Node.create('<div class="loader">'),r=s.templates("flickr-balls")({});return a.appendChild(r),s.albumResultsContainer.appendChild(a),this.searchModel.getValue("sets").getPage(t).then((function(e){return s.isLoadingMore=!1,s.isAtEnd=s.searchModel.getValue("sets").size()>=s.searchModel.getValue("totalItems"),a.remove(),e})).catch((function(e){s.pageNum--,s.isLoadingMore=!1,a.remove(),i.error("Error loading more albums",{err:e})}))},appendItems:function(t){var i=this;return t.forEach((function(e){var t=i.templates("search-photos-album-item")(e);i.albumResultsContainer.append(t)})),e.Promise.resolve()}},{ATTRS:{}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","search-sets-models","search-url","search-helper","hermes-template-search-photos-albums","hermes-template-search-photos-album-item","hermes-template-flickr-balls"],optionalRequires:["global-events","hermes-core"],langBundles:["search","common"]});YUI.add("search-photos-yours-view",(function(e){var t={"photo-models":{name:"photo-list-photo-view",params:{excludePeople:!1}},"photo-lite-models":{name:"photo-list-photo-view",params:{excludePeople:!1}}},i={jst:{rowHeight:150,subviewMapping:t},thm:{rowHeight:120,forceAspectRatio:1,subviewMapping:t},til:{rowHeight:210,forceAspectRatio:1,subviewMapping:Object.assign({},t,{"photo-models":{name:"photo-list-tile-view",params:{excludePeople:!1,showDescription:!1}},"photo-lite-models":{name:"photo-list-tile-view",params:{excludePeople:!1,showDescription:!1}}})},desc:{rowHeight:210,itemSpacing:{horizontal:4,vertical:70},subviewMapping:{"photo-models":{name:"photo-list-description-view"},"photo-lite-models":{name:"photo-list-description-view"}}}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,emptySearch:!1,initializer:function(t){var s,o,a,r;return r=t.rowHeightMod||1,"til"===t.viewType&&(r=Math.max(1,t.rowHeightMod)),""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("search-photos-single-row",{loading:!0,title:this.intlMessage({intlName:"search.YOUR_PHOTOS"}),placeholderHeight:i[t.viewType].rowHeight*r}),this.unifiedSubviewParams=t.unifiedSubviewParams||{},this.unifiedSubviewParams.yours&&this.unifiedSubviewParams.yours.fetchParams?(this.fetchParams=this.unifiedSubviewParams.yours.fetchParams,this.apiParams=e.merge(this.fetchParams.apiParams||{}),this.searchId=this.unifiedSubviewParams.yours.id,this.title=this.unifiedSubviewParams.yours.title):(this.apiParams={},this.fetchParams={}),this.searchUrl=new e.SearchUrl(this.apiParams,this.appContext,e.SearchUrl.searchTypes.PHOTOS),s=i[t.viewType].forceAspectRatio,o=e.clone(i[t.viewType].subviewMapping),a=e.clone(i[t.viewType].itemSpacing),t.photoListConfig={modelParams:{registryName:"search-photos-lite-models",modelIdOrAttributes:this.searchId||this.searchUrl.getId(),collectionAttributeName:"photos",fetchParams:this.fetchParams},pageParams:e.merge(this.fetchParams),paginateOnScroll:!1,keepAwakeOnScroll:!0,parentName:this.name,engagementModelName:"photo-lite-models",injectPhotolistContextParams:{rapidBeaconConfig:{beaconName:"searchYourPhotosResultClick",itemIndexKey:"vespaRnk",searchSection:"photos-yours",searchTerm:t.searchTerm}},measureAFT:!0,mobileLayout:t.allowMobileLayout?{}:null,layout:{containerPadding:{top:0,right:0,bottom:0,left:0},targetRowHeight:i[t.viewType].rowHeight*r,maxNumRows:1,alwaysDisplayOrphans:!0}},s&&(t.photoListConfig.layout.forceAspectRatio=s),o&&(t.photoListConfig.subviewMapping=o),a&&(t.photoListConfig.layout.itemSpacing=a),t.viewType===e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.justified&&(t.photoListConfig.layout.itemSpacing={horizontal:4,vertical:4}),this.rowHeightMod=t.rowHeightMod,this},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var t=this;return this.apiFailed?e.Promise.resolve():this.appContext.getModel("search-photos-lite-models",this.searchId||this.searchUrl.getId(),this.fetchParams).then((function(e){t.searchModel=e,e.getValue("totalItems")<=0&&(t.emptySearch=!0)}))},buildContainer:function(){return this.setContainerWithTemplate("search-photos-single-row",{emptySearch:this.emptySearch,total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),viewAll:this.searchUrl.clone().setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll,!0).getURL(),viewAllDataTrack:"search-viewall-user",title:this.title||this.intlMessage({intlName:"search.YOUR_PHOTOS"})}),this},buildHeadContainer:function(){this.set("headContainer",this.subviews["photo-list-view"].get("headContainer")),this.subviews["photo-list-view"].handleResize(null,!0)},activate:function(){return this},onParentViewEvent:function(e,t){if("search:layoutChange"===(t&&t.length&&t[0]))t[1]&&this.handleLayoutChange(t[1])},handleLayoutChange:function(t){var s=this.subviews["photo-list-view"],o=s.photoListLayout,a=i[t].forceAspectRatio,r=e.clone(i[t].subviewMapping),h=this.rowHeightMod;i.hasOwnProperty(t)&&("til"===t&&(h=Math.max(1,h)),o.targetRowHeight=i[t].rowHeight*h,o.forceAspectRatio=a,s.subviewMapping=r,s.setItems(this.searchModel.getValue("photos").getList()))}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-photos-single-row","photo-list-view","search-photos-lite-models","search-helper","person-preferences-models"],langBundles:["search","common"]});